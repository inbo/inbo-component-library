@switch (dataRequestState()) {
  @case (RequestState.PENDING) {
    <div class="info-message-container">
      <mat-progress-spinner [mode]="'indeterminate'" [diameter]="24"></mat-progress-spinner>
    </div>
  }
  @case (RequestState.ERROR) {
    <div class="info-message-container">
      <img class="info-message-icon" src="/assets/images/Orion_drizzle.svg" alt="Regenwolk"/>
      <p class="info-message-text">
        Er ging iets mis bij het ophalen van de data. Probeer later opnieuw.
      </p>
    </div>
  }
  @default {
    <div>
      <div class="table-scroll-container">
        <table mat-table class="data-table" [dataSource]="dataForRender()"
               matSort
               [matSortActive]="activeSortConfigurationForTable()?.active"
               [matSortDirection]="activeSortConfigurationForTable()?.direction"
               (matSortChange)="dispatchSortChangeEvent($event)">

          @for (displayedColumn of displayedColumns(); track displayedColumn) {
            <ng-container [matColumnDef]="displayedColumn">
              <th mat-header-cell *matHeaderCellDef
                  [ngStyle]="getColumnStyles(displayedColumn)"
                  class="data-table-header-cell">
                <div class="header-content">
                  <span class="column-name"
                        [class.no-filter-border]="!hasAnyFilterableColumn()"
                        mat-sort-header="{{getColumnConfigurationForKey(displayedColumn)?.sortablePropertyName || null}}"
                        [disabled]="!getColumnConfigurationForKey(displayedColumn)?.sortablePropertyName">
                    {{ getColumnConfigurationForKey(displayedColumn)?.name }}
                  </span>
                  @if (getColumnConfigurationForKey(displayedColumn)?.filterable) {
                    <div class="filter-control-wrapper">

                      @switch (getFilterType(displayedColumn)) {
                        @case ('text') {
                          <mat-form-field class="filter-input-field" appearance="fill">
                            <input matInput
                                  [ngModel]="temporaryFilterValues()[displayedColumn]"
                                  (ngModelChange)="updateTemporaryFilter(displayedColumn, $event)"
                                  (keyup.enter)="applyFilter(displayedColumn)"
                                  [placeholder]="getFilterPlaceholder(displayedColumn) || 'Filter'">
                            <span matSuffix style="display: flex;">
                              <button mat-icon-button class="filter-action-button"
                                      (click)="clearFilter(displayedColumn)" aria-label="Clear filter"
                                      [disabled]="!(temporaryFilterValues()[displayedColumn] || filterValues()[displayedColumn])">
                                <mat-icon>clear</mat-icon>
                              </button>
                              @if (getColumnConfigurationForKey(displayedColumn)?.filterMode !== 'local') {
                                <button mat-icon-button class="filter-action-button"
                                        (click)="applyFilter(displayedColumn)" aria-label="Apply filter"
                                        [disabled]="!temporaryFilterValues()[displayedColumn] || temporaryFilterValues()[displayedColumn] === filterValues()[displayedColumn]">
                                  <mat-icon>check</mat-icon>
                                </button>
                              }
                            </span>
                          </mat-form-field>
                        }
                        @case ('autocomplete') {
                          <mat-form-field class="filter-input-field" appearance="fill">
                            <input matInput
                                   [placeholder]="getFilterPlaceholder(displayedColumn) || 'Filter'"
                                   [matAutocomplete]="autoCompleteRef"
                                   [ngModel]="temporaryFilterValues()[displayedColumn]"
                                   (ngModelChange)="updateTemporaryFilter(displayedColumn, $event)"
                                   (input)="onAutocompleteInputTextChanged(displayedColumn, $event)"
                                   (keyup.enter)="applyFilter(displayedColumn)">
                            <mat-autocomplete #autoCompleteRef="matAutocomplete"
                                            (optionSelected)="updateTemporaryFilter(displayedColumn, $event.option.value); applyFilter(displayedColumn)"
                                            [displayWith]="getOptionDisplayText.bind(this, displayedColumn)">
                              @for (option of (autocompleteOptionStreams()[displayedColumn] | async); track option) {
                                <mat-option [value]="option">
                                  {{ getOptionDisplayText(displayedColumn, option) }}
                                </mat-option>
                              }
                            </mat-autocomplete>
                            <span matSuffix style="display: flex;">
                              <button mat-icon-button class="filter-action-button"
                                      (click)="clearFilter(displayedColumn)" aria-label="Clear filter"
                                      [disabled]="!(temporaryFilterValues()[displayedColumn] || filterValues()[displayedColumn])">
                                <mat-icon>clear</mat-icon>
                              </button>
                              @if (getColumnConfigurationForKey(displayedColumn)?.filterMode !== 'local') {
                                <button mat-icon-button class="filter-action-button"
                                        (click)="applyFilter(displayedColumn)" aria-label="Apply filter"
                                        [disabled]="!temporaryFilterValues()[displayedColumn] || temporaryFilterValues()[displayedColumn] === filterValues()[displayedColumn]">
                                  <mat-icon>check</mat-icon>
                                </button>
                              }
                            </span>
                          </mat-form-field>
                        }
                      }
                    </div>
                  }
                </div>
              </th>
              <td mat-cell *matCellDef="let dataItem"
                  [ngStyle]="getColumnStyles(displayedColumn)">
                @if (getColumnConfigurationForKey(displayedColumn)?.cellTemplate; as cellTemplate) {
                  <ng-container
                    [ngTemplateOutlet]="cellTemplate"
                    [ngTemplateOutletContext]="{ $implicit: dataItem[displayedColumn], item: dataItem }">
                  </ng-container>
                } @else {
                  {{
                    getColumnConfigurationForKey(displayedColumn)?.getValue ?
                      getColumnConfigurationForKey(displayedColumn)?.getValue(dataItem[displayedColumn]) :
                      dataItem[displayedColumn]
                  }}
                }
              </td>
            </ng-container>
          }

          @if (editItem.observed) {
            <ng-container [matColumnDef]="EDIT_COLUMN">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let dataItem">
                <button mat-icon-button class="action-button" [disabled]="dataItem.isEditButtonDisabled"
                        (click)="onEditItemClick($event, dataItem)"
                        [class.disabled-button]="dataItem.isEditButtonDisabled">
                  <mat-icon class="material-icons-sharp" title="Aanpassen">edit_square</mat-icon>
                </button>
              </td>
            </ng-container>
          }

          @if (deleteItem.observed) {
            <ng-container [matColumnDef]="DELETE_COLUMN">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let dataItem">
                <button mat-icon-button class="action-button" [disabled]="dataItem.isDeleteButtonDisabled"
                        (click)="onDeleteItemClick($event, dataItem)"
                        [class.disabled-button]="dataItem.isDeleteButtonDisabled">
                  <mat-icon class="material-icons-sharp" title="Verwijderen">delete</mat-icon>
                </button>
              </td>
            </ng-container>
          }

          @if (clickItem.observed) {
            <ng-container [matColumnDef]="DETAIL_COLUMN">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let dataItem">
                <button mat-icon-button class="action-button" [disabled]="dataItem.isViewButtonDisabled"
                        (click)="onViewItemClick($event, dataItem)"
                        [class.disabled-button]="dataItem.isViewButtonDisabled">
                  <mat-icon class="material-icons-sharp" title="Bekijk details">visibility</mat-icon>
                </button>
              </td>
            </ng-container>
          }

          <thead>
            <tr mat-header-row *matHeaderRowDef="allDisplayedColumns()"></tr>
          </thead>
          <tbody>
            <tr mat-row *matRowDef="let row; columns: allDisplayedColumns()"
                [style.height]="rowHeight()"
                (click)="clickItem.emit(row)"></tr>
          </tbody>

          <!-- Row shown when there is no data. -->
          <tr class="mat-row empty-data-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="allDisplayedColumns().length">
              <div class="info-message-container empty-message-in-table">
                <img class="info-message-icon" src="/assets/images/Orion_open-box.svg" alt="Lege doos"/>
                <p class="info-message-text">
                  Deze tabel is leeg.
                </p>
              </div>
            </td>
          </tr>
        </table>

        <mat-paginator
          [pageIndex]="paginatorPageIndex()"
          [pageSize]="effectivePageSizeForDisplay()" [showFirstLastButtons]="true"
          [length]="paginatorLength()" (page)="handlePageEvent($event)">
        </mat-paginator>
      </div>

      @if (dataRequestState() === RequestState.PARTIAL_PENDING) {
        <div class="partial-spinner-container">
          <mat-progress-spinner class="partial-spinner" [mode]="'indeterminate'" [diameter]="24"></mat-progress-spinner>
        </div>
      }
    </div>
  }
}
